# سیستم حسابداری جامع MEHSAB
## معماری و طراحی سیستم

### نمای کلی
سیستم حسابداری MEHSAB یک نرم‌افزار جامع و حرفه‌ای با معماری Domain-Driven Design (DDD) است که بر اساس تحلیل سپیدار سیستم طراحی شده است.

## معماری کلی سیستم

### 1. لایه‌بندی (Layered Architecture)
```
┌─────────────────────────────────────┐
│      Presentation Layer (WPF)      │
│   MVVM Pattern, Views, ViewModels   │
├─────────────────────────────────────┤
│        Application Layer            │
│   Commands, Queries, Services       │
├─────────────────────────────────────┤
│          Domain Layer               │
│   Entities, Value Objects, Rules    │
├─────────────────────────────────────┤
│       Infrastructure Layer          │
│   Repositories, Database, APIs      │
└─────────────────────────────────────┘
```

### 2. تکنولوژی‌ها و ابزارها
- **Framework**: .NET 8
- **UI**: WPF با MVVM Pattern
- **Database**: SQL Server Express/LocalDB
- **ORM**: Entity Framework Core 8
- **Reports**: Stimulsoft Reports
- **Installer**: WiX Toolkit
- **Security**: ASP.NET Core Identity
- **Logging**: Serilog

### 3. ماژول‌های اصلی

#### 3.1 ماژول هسته حسابداری
- کدینگ 5 سطحی (مشابه سپیدار)
- دفتر کل و تفصیلی
- ثبت اسناد دستی و خودکار
- تراز آزمایشی
- صورت‌های مالی (سود/زیان، ترازنامه)

#### 3.2 ماژول انبارداری
- مدیریت کالاها با واحدهای مختلف
- روش‌های قیمت‌گذاری (FIFO, میانگین)
- حرکات انبار (رسید، حواله، انتقال، تعدیل)
- گزارش‌های موجودی

#### 3.3 ماژول فروش و خرید
- صدور فاکتور (پیش‌فاکتور، فاکتور رسمی)
- مدیریت مشتریان و تأمین‌کنندگان
- محاسبه مالیات بر ارزش افزوده
- ارتباط با سامانه مودیان

#### 3.4 ماژول خزانه‌داری
- مدیریت صندوق‌ها و حساب‌های بانکی
- چک‌های دریافتی و پرداختی
- تنخواه‌گردان
- دریافت و پرداخت

#### 3.5 ماژول تولید صنعتی
- مدیریت BOM (Bill of Materials)
- دستورات تولید
- محاسبه بهای تمام‌شده
- کنترل مواد و ضایعات

#### 3.6 ماژول حقوق و دستمزد
- مدیریت پرسنل
- محاسبه حقوق، بیمه، مالیات
- خروجی فایل‌های بیمه
- فیش‌های حقوقی

## Domain Models اصلی

### Chart of Accounts (کدینگ)
```
Level 1: گروه اصلی (1 رقم)    - مثال: 1 (دارایی‌ها)
Level 2: گروه فرعی (2 رقم)    - مثال: 11 (دارایی‌های جاری)
Level 3: کل (4 رقم)           - مثال: 1101 (نقد و بانک)
Level 4: معین (6 رقم)         - مثال: 110101 (صندوق)
Level 5: تفضیلی (8 رقم)       - مثال: 11010101 (صندوق شعبه 1)
```

### Core Entities
1. **Account** - حساب‌ها
2. **Voucher** - سند حسابداری
3. **VoucherItem** - آیتم‌های سند
4. **Customer/Supplier** - مشتری/تأمین‌کننده
5. **Product** - کالا
6. **Warehouse** - انبار
7. **Invoice** - فاکتور
8. **Employee** - پرسنل

## Rule-Based Posting Engine
موتور ثبت خودکار اسناد بر اساس قوانین تعریف شده:

```csharp
public interface IPostingRule
{
    bool CanHandle(BusinessTransaction transaction);
    VoucherDto GenerateVoucher(BusinessTransaction transaction);
}
```

### نمونه قوانین:
1. فروش نقدی → بدهکار: صندوق، بستانکار: فروش
2. خرید کالا → بدهکار: خرید، بستانکار: تأمین‌کننده
3. دریافت چک → بدهکار: چک دریافتی، بستانکار: مشتری

## امنیت و Audit
- User Management با سطوح دسترسی
- Audit Trail برای تمام تراکنش‌ها
- Soft Delete با امکان بازیابی
- Digital Signature برای اسناد مهم

## گزارش‌گیری
- صورت‌های مالی استاندارد
- گزارش‌های تحلیلی
- Dashboard مدیریتی
- خروجی Excel, PDF, Word

## انطباق با قوانین ایران
- تقویم شمسی
- مالیات بر ارزش افزوده
- سامانه مودیان
- قوانین حسابداری ایران

این معماری قابلیت‌های پیشرفته‌ای مانند سپیدار سیستم را فراهم می‌کند ولی با معماری مدرن‌تر و قابل توسعه‌تر.